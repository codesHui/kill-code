<!DOCTYPE html>
<!--<#include "comm.ftl" /><#include "adminNav.ftl"/><@doctype />  -->
<html>
<head>
<meta charset="utf-8">
<title>产品查询</title>
<!--<@cssJs /> -->
<style type="text/css">
*+html .leftbox .titlename{margin-right:-3px}/* IE7 */ 
*+html  .input_div{ /* background-color: olive; */padding: 0px;text-align: left;}/* IE7 */ 
.yijinav  a{
text-decoration: none;color: #3F3F3F;
}
.nav_off{
display: none;
}

.acitve {
  background-color: rgb(230, 227, 227);;
  color: #3C9CD3;
}


</style>
	</head>
	<body>
	<!--<@logonTop user="${userNickName}" />-->
	<!-- <@adminnav title="复查处理"  second="复查处理"   role="${current_role}" /> -->
		

		<form id='reviewsForm' action="<@s.url '/admin/review/reviewslist'/>" method="post" enctype="multipart/form-data">
		<div class="product_condition" align="center" style="margin-top: 40px;">
					<div class="content">
					<div class="float_left leftbox" style="margin-left: 25px;">
						<div class="hangstyle margin_top_10">
							<div class="float_left titlename" >产品类别：</div>
							<div>
							    <input type="hidden" id="productType" name="productType" value="${productInfo.productType}" />
								<div id="category_all" class="float_left margin_top_15 margin_left_10 radio_normal">
								</div>
								<span  style="margin-left: 5px;" class="float_left">全部</span>
								<div id="category_pre"  class="float_left margin_top_15 margin_left_20 radio_normal">
								</div>
								<span  style="margin-left: 5px;" class="float_left">主险</span>
								<div id="category_add"  class="float_left margin_top_15 margin_left_20 radio_normal">
								</div>
								<span  style="margin-left: 5px;" class="float_left">附加险</span>
								<div id="category_other"  class="float_left margin_top_15 margin_left_20 radio_normal">
								</div>
								<span  style="margin-left: 5px;" class="float_left">其他</span>
							</div>
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">注册号：</div>
							<div style="width: 300px;">
								<input type="tel" name="productNO" value="${productInfo.productNO}"/>
							</div>
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">注册人：</div>
							<div style="width: 300px;">
								<input type="tel" name="registPerson" value="${productInfo.registPerson}"/>
							</div>
						</div>
					</div>
				<div class="float_left leftbox">
						<div class="hangstyle margin_top_10">
						<input type="hidden" id="reviewStatus" name="reviewStatus" value="${reviewStatus}"/>
							<div class="float_left titlename" >状态：</div>
							<div>
								<div id="status_all" class="float_left margin_top_15 margin_left_10 radio_normal">
								</div>
								<span  style="margin-left: 5px;" class="float_left">全部</span>
								<div id="status_normal" class="float_left margin_top_15 margin_left_10 radio_normal">
								</div>
								<span  style="margin-left: 5px;" class="float_left">未复查</span>
								<div id="status_cancle" name="status" value="1" class="float_left margin_top_15 margin_left_20 radio_normal">
								</div>
								<span  style="margin-left: 5px;" name="status" value="2" class="float_left">已复查</span>
							</div>
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">产品名称：</div>
							<div style="width: 300px;">
								<input type="tel"  value="${productInfo.productName}" name="productName"/>
							</div>
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">险类：</div>
							<div class="input_div"  style="width: 300px;">
								<@dictSelect value="${productInfo.riskType}" type="RISK" id="riskType" name="riskType" option="全部" showSelect=true onChange="getRiskName(this.options[this.selectedIndex].value);"/>
							</div>
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">险种：</div>
							<div class="input_div" style="width: 300px;">
								<@dictSelect value="${productInfo.riskName}" type="${productInfo.riskType}" id="riskName" name="riskName" option="全部" showSelect=true/>
							</div>
						</div>
					</div>
				</div>
			<div class="bottomdiv">
				<input type="hidden" id="pagenumber" name="pagenumber"/>
				<button  onclick="select()">查&nbsp;&nbsp;&nbsp;&nbsp;询</button>
				<button  onclick="importExcel()" >导&nbsp;&nbsp;&nbsp;&nbsp;出</button> <!--*)新增功能 导出-->
			</div>
			</div>
		</form>
		
		<div class="product_content" align="center">
			<div class="toptitle">
				<div class="contentname">
					<div>
						序号
					</div>
					<div>
						产品类别
					</div>
					<div>
						注册号
					</div>
					<div>
						险类
					</div>
					<div>
						险种
					</div>
					<div>
						注册人
					</div>
					<div>
						产品名称
					</div>
					<div>
						当前状态
					</div>
					<div>
						处理时间
					</div>
					<div>
						附加险
					</div>
					<div>
						主险
					</div>
					<div>
						查询详情
					</div>
				</div>
			</div>
			<div class="content_all">
				<ul class="contentall_li">
				<#list reviewlist as review>
					<li>
						<div class="lidiv">
							<div>
								&nbsp;&nbsp;${review_index+((page-1)*10+1)?default(1)}
							</div>
							<div>
								&nbsp;&nbsp;<#if (review.product.productType =="1")>主险</#if><#if (review.product.productType =="2")>附加险</#if><#if (review.product.productType ="3")>其他</#if>
							</div>
							<div>
								&nbsp;&nbsp;${review.product.productNO} 
							</div>
							<div>
								<!--险类-->
								&nbsp;&nbsp;<@dictDisplay value="${review.product.riskType}" type="RISK" />
							</div>
							<div>
								<!--险种-->
								&nbsp;&nbsp;<@dictDisplay value="${review.product.riskName}" type="${review.product.riskType}" />
							</div>
							<div title="${review.product.registPerson}">
								&nbsp;&nbsp;<@textCut value="${review.product.registPerson}" len=12 append="..." />
							</div>
							<div title="${review.product.productName}">
								&nbsp;&nbsp;<@textCut value="${review.product.productName}" len=12 append="..." />
							</div>
							<div>
								&nbsp;&nbsp;
								<@shiro.hasRole name="admin1"> 
									<#if (review.flowCheck1 ==0)>
										未复查
									<#else>
										已复查
									</#if>					 
								</@shiro.hasRole> 
								<@shiro.hasRole name="admin2"> 
									<#if (review.flowCheck2 ==0)>
										未复查
									<#else>
										已复查
									</#if>								 
								</@shiro.hasRole> 
								<@shiro.hasRole name="admin3"> 
									<#if (review.flowCheck3 ==0)>
										未复查
									<#else>
										已复查
									</#if>							 
								</@shiro.hasRole> 
								
							</div>
							<div>
								&nbsp;&nbsp;${review.modifiedTime}
							</div>
                            <div>
                                <#if (review.product.addSafe!=0&&review.product.addSafe!=null)>
								&nbsp;&nbsp;${review.product.addSafe}
                                </#if>
							</div>
							<div>
                                <#if (review.product.mainSafe!=0&&review.product.mainSafe!=null)>
								&nbsp;&nbsp;${review.product.mainSafe}
                                </#if>
							</div>
							<div>
								 <button onclick="window.open('<@s.url '/admin/review/reviewshandle?reviewId=${review.id}&productId=${review.product.id}'/>','_blank')">开始复查</button>
							</div>
						</div>
					</li>
				   </#list>
				</ul>
			</div>
			<div class="divbottom">
				<!-----------------------分页样式开始------------------------>
				<div class="pager-plugin" id="pager"></div>
			</div>
		</div>	
		
		<div class="fisrt_bottom_xian"></div>		
	<!--<#include "ufoot.html"/><!--尾部结束-->
		<script type="text/javascript">
		
		//险种二级联动
		  function getRiskName(key){
			$("#riskName").html("");
			$("#riskName").append("<option value=''>全部</option>");
			  $.ajax({
			        type : "post",
			        url : "<@s.url '/front/product/riskName'/>",
			        data : {
			        	key : $("#riskType").val()
			        },
			        dataType : "json",
			        success : function(data) {
			        	if(data.success)
						{
				           for(var i =0;i<data.data.length;i++){
				        	   var dic=data.data[i].split("|");
				        	   $("#riskName").append("<option value='" + dic[0] + "'>"  + dic[1] + "</option>"); 
				          } 
						}
			        }
			   });  
		  }
	    
		
		
			$(function(){
					//单选按钮初始化
					var productType = $("#productType").val();
					var reviewStatus = $("#reviewStatus").val();
					if(productType == "" || productType == 0){
						$("#category_all").removeClass("radio_normal").addClass("radio_checked");
					}
					if(productType == 1){
						$("#category_pre").removeClass("radio_normal").addClass("radio_checked");
					}
					if(productType == 2){
						$("#category_add").removeClass("radio_normal").addClass("radio_checked");
					}
					//其他类别
					if(productType == 3){
						$("#category_other").removeClass("radio_normal").addClass("radio_checked");
					}
					if(reviewStatus == "" || reviewStatus == 0){
						$("#status_all").removeClass("radio_normal").addClass("radio_checked");
					}
					if(reviewStatus == 1){
						$("#status_normal").removeClass("radio_normal").addClass("radio_checked");
					}
					if(reviewStatus == 2){
						$("#status_cancle").removeClass("radio_normal").addClass("radio_checked");
					}
					//单选按钮事件
					$("#category_all").click(function(){
						if($("#category_pre").hasClass("radio_checked")||$("#category_add").hasClass("radio_checked")||$("#category_other").hasClass("radio_checked")){
							$("#category_add").removeClass("radio_checked").addClass("radio_normal");
							$("#category_pre").removeClass("radio_checked").addClass("radio_normal");
							$("#category_all").removeClass("radio_normal").addClass("radio_checked");
							$("#category_other").removeClass("radio_checked").addClass("radio_normal");
							$("#productType").val(0);
						}
					});
					$("#category_pre").click(function(){
						if($("#category_add").hasClass("radio_checked")||$("#category_all").hasClass("radio_checked")||$("#category_other").hasClass("radio_checked")){
							$("#category_add").removeClass("radio_checked").addClass("radio_normal");
							$("#category_all").removeClass("radio_checked").addClass("radio_normal");
							$("#category_pre").removeClass("radio_normal").addClass("radio_checked");
							$("#category_other").removeClass("radio_checked").addClass("radio_normal");
							$("#productType").val(1);
						}
					});
					$("#category_add").click(function(){
						if($("#category_pre").hasClass("radio_checked")||$("#category_all").hasClass("radio_checked")||$("#category_other").hasClass("radio_checked")){
							$("#category_pre").removeClass("radio_checked").addClass("radio_normal");
							$("#category_all").removeClass("radio_checked").addClass("radio_normal");
							$("#category_add").removeClass("radio_normal").addClass("radio_checked");
							$("#category_other").removeClass("radio_checked").addClass("radio_normal");
							$("#productType").val(2);
						}
					});
					$("#category_other").click(function(){
						if($("#category_pre").hasClass("radio_checked")||$("#category_all").hasClass("radio_checked")||$("#category_add").hasClass("radio_checked")){
							$("#category_pre").removeClass("radio_checked").addClass("radio_normal");
							$("#category_all").removeClass("radio_checked").addClass("radio_normal");
							$("#category_add").removeClass("radio_checked").addClass("radio_normal");
							$("#category_other").removeClass("radio_normal").addClass("radio_checked");
							$("#productType").val(3);
						}
					});
					$("#status_all").click(function(){
						if($("#status_cancle").hasClass("radio_checked")||$("#status_normal").hasClass("radio_checked")){
							$("#status_cancle").removeClass("radio_checked").addClass("radio_normal");
							$("#status_normal").removeClass("radio_checked").addClass("radio_normal");
							$("#status_all").removeClass("radio_normal").addClass("radio_checked");
							$("#reviewStatus").val(0);
						}
					});
					$("#status_normal").click(function(){
						if($("#status_cancle").hasClass("radio_checked")||$("#status_all").hasClass("radio_checked")){
							$("#status_cancle").removeClass("radio_checked").addClass("radio_normal");
							$("#status_all").removeClass("radio_checked").addClass("radio_normal");
							$("#status_normal").removeClass("radio_normal").addClass("radio_checked");
							$("#reviewStatus").val(1);
						}
					});
					$("#status_cancle").click(function(){
						if($("#status_normal").hasClass("radio_checked")||$("#status_all").hasClass("radio_checked")){
							$("#status_normal").removeClass("radio_checked").addClass("radio_normal");
							$("#status_all").removeClass("radio_checked").addClass("radio_normal");
							$("#status_cancle").removeClass("radio_normal").addClass("radio_checked");
							$("#reviewStatus").val(2);
						}
					});
				//给列表设置样式,行数为单数样式为#----.contentall_li
				$(".contentall_li li:even").css("background-color","#E6E3E3");
				$(".contentall_li li:odd").css("background-color","#F2F2F2");
				$(".selectstyle ul li:not(.optionselect)").hover(
					function(){
						$(this).css("background-color","#69AAEC");
						$(this).css("color","#fff");
					},
					function(){
						$(this).css("background-color","#fff");
						$(this).css("color","#333");
					}
				);
				$(".selectstyle ul li").click(function(){
					//alert($(this).text());
					$(".typevalue").html($(this).text());
					$("#optionstyle").css("display","none");
				});
				$("#xianlei").click(function(){
					$("#optionstyle").css("display","block");
				});
			});
			
			//---------------------分页样式开始----------------------
			$(function(){
				total = ${total};
 				//分页
				PageClick = function(pageclickednumber) {
		       		$("#pager").pager({ pagenumber: pageclickednumber, pagecount: total, buttonClickCallback: PageClick });
		        	//跳转
		            $("#pagenumber").val(pageclickednumber);
		            $("#reviewsForm").submit();
                    select();
	    		}	
	    		if(total > 0)
				{
	    			//后台BaseDaoImpl默认是第一页每页5条记录
		   			total = Math.floor(total%10==0?total/10:(total/10+1));
		   			$("#pager").pager({ pagenumber: ${page}, pagecount: total, buttonClickCallback: PageClick });
				}
	    
			});
			//---------------------分页样式结束----------------------

       		 //筛选条件
        	function select(){
				var path = "<@s.url '/admin/review/reviewslist'/>" ;
				$('#reviewsForm').attr("action", path).submit();
        	}

			//导出Excel功能点击事件start
        	function importExcel(){
            var path = "<@s.url'/admin/review/import_product'/>" ;
            $('#reviewsForm').attr("action", path).submit();
            //客户端在发起导出请求后，需要等待服务器处理超过60s的时间才能响应，处理完毕之前服务器不会与客户端有任何数据交互，WAF会返回一个504超时响应到客户端，同时断开链接，目前WAF的超时时间无法修改
            //解决方案：50s的定时任务
            setInterval(function(){
                $.ajax({
                    type : "post",
                    url : "<@s.url '/front/timedinteraction'/>",
                    dataType : "json",
                    success : function(data) {
                        if(data.success)
                        {
                            console.log("可以");
                        }
                    }
                });
            },50000);
        }
        	//导出Excel功能点击事件end

		</script>
		
		
	</body>
</html>
