<!DOCTYPE html>
<!--<#include "comm.ftl" /><#include "bjsAdmin.ftl"/><@doctype />  -->
<html>
<head>
<meta charset="utf-8">
<title>信息管理</title>
<!--<@cssJs /> -->
<style type="text/css">
*+html .leftbox .titlename{margin-right:-3px}/* IE7 */ 
*+html  .input_div{ /* background-color: olive; */padding: 0px;text-align: left;}/* IE7 */ 
.yijinav  a{
text-decoration: none;color: #3F3F3F;
}
.nav_off{
display: none;
}

.acitve {
  background-color: rgb(230, 227, 227);;
  color: #3C9CD3;
}


</style>
	</head>
	<body>
	<!--<@logonTop user="${userNickName}" />-->
	<!-- <@adminnav title="信息管理"  second="保单信息查询"/> -->
		<script type="text/javascript" src="<@s.url '/resources/datePicker/WdatePicker.js'/>" ></script>
		<form action="<@s.url'/bjsAdmin/policy/listAll'/>" method="post" id="submit_product_info">
		<div class="product_condition" align="center" style="margin-top: 40px;">
				<div class="content">
					<div class="float_left leftbox" style="margin-left: 25px;">
						<div class="hangstyle margin_top_10">
							<div class="float_left titlename">起保/起航开始时间：</div>
							<div class="input_div" style="width: 300px;">
								<input id="policyStartTime" type="text" name="policyStartTime"  value="${policyInformation.policyStartTime}" class="datePicker" onClick="WdatePicker()">
								<div>${policyInformation.policyStartTime}</div>
							</div>
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">保单号：</div>
							<div class="input_div" style="width: 300px;">
								<input type="tel" name="policyNo" id="policyNo" value="${policyInformation.policyNo}"/>
							</div>
						</div>
						
					</div>
				<div class="float_left leftbox">
						<!-- <div class="hangstyle margin_top_10">
						<input type="hidden" id="status" name="status" value="${productInfo.status}" />
							<div class="float_left titlename" >状态：</div>
							<div>
								<div id="status_all" class="float_left margin_top_15 margin_left_10 radio_normal"></div>
								<span  style="margin-left: 5px;" class="float_left">全部</span>
								<div id="status_normal" class="float_left margin_top_15 margin_left_10 radio_normal"></div>
								<span  style="margin-left: 5px;" class="float_left">已处理</span>
								<div id="status_cancle"  value="2" class="float_left margin_top_15 margin_left_20 radio_normal"></div>
								<span  style="margin-left: 5px;"  value="1" class="float_left">未处理</span>
							</div>
						</div> -->
						<div class="hangstyle margin_top_10">
							<div class="float_left titlename">起保/起航结束时间：</div>
							<div class="input_div" style="width: 300px;">
								<input type="text" id="policyEndTime" name="policyEndTime" value="${policyInformation.policyEndTime}" onClick="WdatePicker()">
							</div>
		
						</div>
						<div class="hangstyle">
							<div class="float_left titlename">险类：</div>
							<div class="input_div"  style="width: 300px;">
								<!-- <@dictSelect value="${productInfo.riskType}" type="RISK" id="riskType" name="riskType" option="全部" showSelect=true onChange="getRiskName(this.options[this.selectedIndex].value);"/> -->
								<!-- 由于上传文件中险种已经给死5个脚本，与项目经理商量后 方案：先写死 -->
								<@dictSelect value="${policyInformation.riskType}" type="REPORT_RISK" id="riskType" name="riskType" option="全部" showSelect=true />
							</div>
						</div>
					
						<div class="hangstyle">
							<div class="float_left titlename">保险公司：</div>
							<div class="input_div" style="width: 300px;">
									<@select id="policyUploadUnit" datas=musers value="${policyInformation.policyUploadUnit}"
									key="registeredCode" text="companyShortName" default="请选择"/>
							</div>
						</div>
						<!-- <div class="hangstyle">
							<div class="float_left titlename">投诉时间：</div>
							<div class="input_div"  style="width: 300px;">
								<input type="tel"  value="" name=""/>
							
							</div>
						</div> -->
						<!-- <div class="hangstyle">
							<div class="float_left titlename"></div>
							<div class="input_div" style="width: 300px;">
								
							</div>
						</div> -->
					</div>
				</div>
				<input id="hquerypage" name="page" type="hidden" >
				<div class="bottomdiv">
					<button onclick="select();">查&nbsp;&nbsp;&nbsp;&nbsp;询</button>
					<button onclick="importExcel();">导&nbsp;&nbsp;&nbsp;&nbsp;出</button>
				</div>
			</div>
		</form>
		<div class="product_content" align="center">
			<div class="toptitle">
				<div class="contentname">
				<div>保单号</div>
				<div>险种名称</div>
				<div>保险人</div>
				<div>被保险人</div>
				<div>保额</div>
				<div>保费</div>
				<div>币种</div>
				<div>起保日期</div>
				<div>终保日期</div>
				<div>起航日期</div>
				<div>查询详情</div>
				</div>
			</div>
			<div class="content_all">
				<ul class="contentall_li">
				
				<#if policyInformation.listPolicy??> 
					<#list policyInformation.listPolicy as c>
						<li>
							<div class="lidiv">
							<div>&nbsp;&nbsp;${c.policyNo}</div>
							<div>&nbsp;&nbsp;${c.riskName}</div>
							<div>&nbsp;&nbsp;${c.appntName}</div>
							<div>&nbsp;&nbsp;${c.insuredName}</div>
							<div>&nbsp;&nbsp;${c.amount}</div>
							<div>&nbsp;&nbsp;${c.prem}</div>
							<div>&nbsp;&nbsp;${c.currency}</div>
							<div>&nbsp;&nbsp;<#if ((c.policyStartTime??)&&(c.policyStartTime!="")&&(c.policyStartTime?length gt 7))>${c.policyStartTime?substring(0,4)}/${c.policyStartTime?substring(4,6)}/${c.policyStartTime?substring(6,8)}</#if></div>
							<div>&nbsp;&nbsp;<#if ((c.policyEndTime??)&&(c.policyEndTime !="")&&(c.policyEndTime?length gt 7))>${c.policyEndTime?substring(0,4)}/${c.policyEndTime?substring(4,6)}/${c.policyEndTime?substring(6,8)}</#if></div>
							<div>&nbsp;&nbsp;<#if ((c.sailingDate??)&&(c.sailingDate !="")&&(c.sailingDate?length gt 7))>${c.sailingDate?substring(0,4)}/${c.sailingDate?substring(4,6)}/${c.sailingDate?substring(6,8)}</#if></div>
							<div >
								<button type="button" onclick="detail('${c.id}','${c.riskType}');">查看详情</button>
							</div>
							</div>
						</li>
					</#list>
   		 		</#if> 
				</ul>
			
			</div>
			<div class="divbottom">
			<div class="pager-plugin" id="pager"></div>
		</div>		
		</div>
		<div class="fisrt_bottom_xian"></div>
		<#include "ufoot.html"/>
		<script type="text/javascript">
		
			$(function(){
				
				var str = $("#policyUploadUnit").val();
				for(var i=0;i<document.getElementById('policyUploadUnit').options.length;i++){ 
					if(document.getElementById('policyUploadUnit').options[i].value == str){ 
						document.getElementById('policyUploadUnit').options[i].selected=true; 
					} 
				} 
				
				//单选按钮初始化
				var productType = $("#productType").val();
				var status = $("#status").val();     
				if(productType == "" || productType == 0){
					$("#category_all").removeClass("radio_normal").addClass("radio_checked");
				}
				if(productType == 1){
					$("#category_pre").removeClass("radio_normal").addClass("radio_checked");
				}
				if(productType == 2){
					$("#category_add").removeClass("radio_normal").addClass("radio_checked");
				}
				if(status == "" || status == 0){
					$("#status_all").removeClass("radio_normal").addClass("radio_checked");
				}
				if(status == 2){
					$("#status_normal").removeClass("radio_normal").addClass("radio_checked");
				}
				if(status == 1){
					$("#status_cancle").removeClass("radio_normal").addClass("radio_checked");
				}
				//单选按钮事件
				$("#category_all").click(function(){
					if($("#category_pre").hasClass("radio_checked")||$("#category_add").hasClass("radio_checked")){
						$("#category_add").removeClass("radio_checked").addClass("radio_normal");
						$("#category_pre").removeClass("radio_checked").addClass("radio_normal");
						$("#category_all").removeClass("radio_normal").addClass("radio_checked");
						$("#productType").val(0);
					}
				});
				$("#category_pre").click(function(){
					if($("#category_add").hasClass("radio_checked")||$("#category_all").hasClass("radio_checked")){
						$("#category_add").removeClass("radio_checked").addClass("radio_normal");
						$("#category_all").removeClass("radio_checked").addClass("radio_normal");
						$("#category_pre").removeClass("radio_normal").addClass("radio_checked");
						$("#productType").val(1);
					}
				});
				$("#category_add").click(function(){
					if($("#category_pre").hasClass("radio_checked")||$("#category_all").hasClass("radio_checked")){
						$("#category_pre").removeClass("radio_checked").addClass("radio_normal");
						$("#category_all").removeClass("radio_checked").addClass("radio_normal");
						$("#category_add").removeClass("radio_normal").addClass("radio_checked");
						$("#productType").val(2);
					}
				});
				$("#status_all").click(function(){
					if($("#status_cancle").hasClass("radio_checked")||$("#status_normal").hasClass("radio_checked")){
						$("#status_cancle").removeClass("radio_checked").addClass("radio_normal");
						$("#status_normal").removeClass("radio_checked").addClass("radio_normal");
						$("#status_all").removeClass("radio_normal").addClass("radio_checked");
						$("#status").val(0);
					}
				});
				$("#status_normal").click(function(){
					if($("#status_cancle").hasClass("radio_checked")||$("#status_all").hasClass("radio_checked")){
						$("#status_cancle").removeClass("radio_checked").addClass("radio_normal");
						$("#status_all").removeClass("radio_checked").addClass("radio_normal");
						$("#status_normal").removeClass("radio_normal").addClass("radio_checked");
						$("#status").val(2);
					}
				});
				$("#status_cancle").click(function(){
					if($("#status_normal").hasClass("radio_checked")||$("#status_all").hasClass("radio_checked")){
						$("#status_normal").removeClass("radio_checked").addClass("radio_normal");
						$("#status_all").removeClass("radio_checked").addClass("radio_normal");
						$("#status_cancle").removeClass("radio_normal").addClass("radio_checked");
						$("#status").val(1);
					}
				});
				
				
				//给列表设置样式,行数为单数样式为#----.contentall_li
				$(".contentall_li li:even").css("background-color","#E6E3E3");
				$(".contentall_li li:odd").css("background-color","#F2F2F2");
				$(".selectstyle ul li:not(.optionselect)").hover(
					function(){
						$(this).css("background-color","#69AAEC");
						$(this).css("color","#fff");
					},
					function(){
						$(this).css("background-color","#fff");
						$(this).css("color","#333");
					}
				);
				
			    
			});
			
			//$("#policyUploadUnit").html("");
			/* $.ajax({
				type : "post",
		        url : "<@s.url '/bjsAdmin/policy/getAllCompany'/>",
		        dataType : "json",
		        success : function(data) {
		        	if(data.success)
					{
			           for(var i =0;i<data.data.length;i++){
			        	   var dic=data.data[i].split("|");
			        	   $("#policyUploadUnit").append("<option value='" + dic[0] + "'>"  + dic[1] + "</option>"); 
			          } 
					}
		        }
			});	
			 */
			//分页
			PageClick = function(pageclickednumber) {
		        $("#pager").pager({ pagenumber: pageclickednumber, pagecount: total, buttonClickCallback: PageClick });
		        //跳转
		       // location = '?page='+pageclickednumber;
		        $("#hquerypage").val(pageclickednumber);
		        select();
		    }
			var total = ${policyInformation.total};
		    if(total > 0)
			{
			   total = Math.floor(total%10==0?total/10:(total/10+1));
			   var page = "${policyInformation.page}";
 			   if('${policyInformation.page}'.indexOf(",")>0){
 				  page = '${policyInformation.page}'.replace(",","");
 			   }
			   $("#pager").pager({ pagenumber: page, pagecount: total, buttonClickCallback: PageClick });
			}
		    

			//筛选条件
			function select(){
				var path = "<@s.url'/bjsAdmin/policy/listAll'/>" ;
				$('#submit_product_info').attr("action", path).submit();
			}
			//查看详情
			function detail(id,riskType){
				window.location.href="<@s.url '/bjsAdmin/policy/details?riskType='/>"+riskType+"&policyId="+id;
			}
			//导出表格
			function importExcel(){
				var path = "<@s.url'/bjsAdmin/policy/upload'/>" ;
				$('#submit_product_info').attr("action", path).submit();
				//客户端在发起导出请求后，需要等待服务器处理超过60s的时间才能响应，处理完毕之前服务器不会与客户端有任何数据交互，WAF会返回一个504超时响应到客户端，同时断开链接，目前WAF的超时时间无法修改
				//解决方案：50s的定时任务
				setInterval(function(){
					$.ajax({
						type : "post",
						url : "<@s.url '/front/timedinteraction'/>",
						dataType : "json",
						success : function(data) {
					        	if(data.success)
								{
						          console.log("可以");
								}
					        }
					});
				},50000);
			}
			
			//险种二级联动
			  function getRiskName(key){
				$("#riskName").html("");
				$("#riskName").append("<option value=''>全部</option>");
				  $.ajax({
				        type : "post",
				        url : "<@s.url '/front/product/riskName'/>",
				        data : {
				        	key : $("#riskType").val()
				        },
				        dataType : "json",
				        success : function(data) {
				        	if(data.success)
							{
					           for(var i =0;i<data.data.length;i++){
					        	   var dic=data.data[i].split("|");
					        	   $("#riskName").append("<option value='" + dic[0] + "'>"  + dic[1] + "</option>"); 
					          } 
							}
				        }
				   });  
			  }
		    
		</script>
	</body>
</html>
